<html>
<head>
    <title>RPG</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="/css/my.css" rel="stylesheet">
</head>
<body>
<h1>RPG admin panel</h1>

<div style="margin-top: 20 px;"> <!--выпадающий список-->
    <label for="pageSize">Count per page: </label>
    <select id="pageSize">
        <option value="3">3</option>
        <option value="5">5</option>
        <option value="10" selected>10</option>
        <option value="20">20</option>
    </select>
</div>


<table id="playerTable" border="1">
    <thead>
    <tr>
        <th>#</th>
        <th>Name</th>
        <th>Title</th>
        <th>Race</th>
        <th>Profession</th>
        <th>Level</th>
        <th>Birthday</th>
        <th>Banned</th>
        <th>Edit</th>
        <th>Delete</th>
    </tr>
    </thead>
    <tbody>
    <!-- Данные будут загружаться сюда -->
    </tbody>
</table>

<div id="pagination" style="margin-top: 10px;"></div>
<!--кнопки пейджинга-->


<script>

    let totalPlayers = 0;
    let currentPage = 0;
    let pageSize = parseInt($('#pageSize').val());

<!--    Загрузка общего количества игроков-->
    function fetchPlayerCount() {
        $.get("/rest/players/count", function(count) {
            totalPlayers = count;
            renderPagination();
            loadPlayerData(currentPage, pageSize);
        });
    }

<!--	Загрузка игроков с учетом номера страницы и размера-->
    function loadPlayerData(page, size) {
        $.get("/rest/players", { pageNumber: page, pageSize: size }, function(data) {
            const tbody = $('#playerTable tbody');
            tbody.empty();
<!--            очистить таблицу-->

	   data.forEach(function(player, index) {
                const rowHtml = `
                <tr id="player-row-${player.id}">
                    <td>${page * size + index + 1}</td>
                    <td>${player.name}</td>
                    <td>${player.title}</td>
                    <td>${player.race}</td>
                    <td>${player.profession}</td>
                    <td>${player.level}</td>
                    <td>${player.birthday}</td>
                    <td>${player.banned}</td>
                    <td>
                        <img src="/img/edit.png" alt="Edit" width="20" height="20" class="edit-btn" style="cursor:pointer" onclick="editPlayer(${player.id})">
                    </td>
                    <td>
                        <img src="/img/delete.png" alt="Delete" width="20" height="20" class="delete-btn" style="cursor:pointer" onclick="deletePlayer(${player.id})">
                    </td>

                </tr>
            `;
            tbody.append(rowHtml);
            });
        });
    }

<!--    Отображение кнопок пейджинга-->
    function renderPagination() {
        const totalPages = Math.ceil(totalPlayers / pageSize);
        const paginationDiv = $('#pagination');
        paginationDiv.empty();

        for (let i = 0; i < totalPages; i++) {
            const btn = $(`<button class="pagination-btn">${i + 1}</button>`);

            if (i === currentPage) {
                btn.addClass('active');


            }
            btn.on('click', function() {
                currentPage = i;
                loadPlayerData(currentPage, pageSize);
                renderPagination();
            });
            paginationDiv.append(btn);
        }
    }

<!--    Смена значения количество строк на странице (в select)-->
    $('#pageSize').on('change', function() {
        pageSize = parseInt($(this).val());
        currentPage = 0;
        fetchPlayerCount(); // пересчитать и отрисовать
    });

<!--    Запросить всё при загрузке страницы-->
    $(document).ready(function() {
        fetchPlayerCount();

    });

<!--    функция удаления аккаунта-->
    function deletePlayer(id) {
        $.ajax({
            url: `/rest/players/${id}`,
            type: 'DELETE',
            success: function () {
<!--            Обновляем общее количество и таблицу-->
<!--            это заново посчитает страницы и вызовет loadPlayerData()-->
                fetchPlayerCount();
            },
        });
    }
<!--    функция редактирования аккаунта-->
    function editPlayer(id){
        const row = $(`#player-row-${id}`);

<!--        скрываю иконку delete-->
        row.find('.delete-btn').hide();

<!--        меняем иконку edit на save-->
        const editIcon = row.find('.edit-btn');
        editIcon.attr('src', '/img/save.png');
        editIcon.attr('alt', 'Save');

<!--        меняем обработчик на savePlayer-->
        editIcon.off('click');
        editIcon.on('click', function() {
            savePlayer(id)
        });
    }

<!--    savePlayer(id) заглушка-->
    function savePlayer(id) {
        alert("Save player ID: " + id);
        // TODO: Здесь будет логика отправки PUT-запроса
        fetchPlayerCount();
    }


</script>

</body>
</html>